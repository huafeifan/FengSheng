WaitResponse = {}
WaitResponse.__index = WaitResponse

local waitTime = 5

function WaitResponse:New(gameObject)
	local item = {}
	item.gameObject = gameObject
	item.transform = gameObject.transform
	item.ui = {}

	setmetatable(item, WaitResponse)
	return item
end

function WaitResponse:InitUIReference()
	self.ui.slider = self.transform:Find("Slider"):GetComponent(typeof(Image))
end

function WaitResponse:InitUI()
	self.gameObject:SetActive(false)
	self.isStart = false
end

function WaitResponse:AddUIEvent()
	
end

function WaitResponse:RemoveUIEvent()
	
end

function WaitResponse:Update()
	if self.isStart == true then
		if self.remainTime > Time.time then
			self.ui.slider.fillAmount = (self.remainTime - Time.time) / waitTime
		else
			self.ui.slider.fillAmount = 0
			self.isStart = false
			self.gameObject:SetActive(false)
			
			local sendData = {}
			sendData.userName = Global.Data.User.UserName
			sendData.isSkip = true
			local dataBytes = Global.Protos.Methods.Lua2Bytes(Global.Protos.FileName.Game, Global.Protos.Class.PlayHandCardResponse_C2S, sendData)
			NetManager:Send(Global.Login.Network, Global.Protos.Cmd.PlayHandCardResponse_C2S, dataBytes)
		end
	end
end

function WaitResponse:OnReceiveAskPlayHandCard(data)
	for i = 1, #data.userName do
		if data.userName[i] == Global.Data.User.UserName then
			self.remainTime = Time.time + waitTime
			self.gameObject:SetActive(true)
			self.isStart = true
			break
		end
	end
end

function WaitResponse:OnReceiveStopWaitResponseTimer()
	self.isStart = false
	self.gameObject:SetActive(false)
end

function WaitResponse:OnReceivePlayerWantPlayHandCard(data)
	self.isStart = false
	self.gameObject:SetActive(false)
end

function WaitResponse:AddListener()
	EventManager:AddListener(Global.Event.InformationStage.ReceiveAskPlayHandCard, function(data) self:OnReceiveAskPlayHandCard(data) end, "Lua.game.waitResponse.OnReceiveAskPlayHandCard")
	EventManager:AddListener(Global.Event.InformationStage.StopWaitResponseTimer, function() self:OnReceiveStopWaitResponseTimer() end, "Lua.game.waitResponse.OnReceiveStopWaitResponseTimer")
	EventManager:AddListener(Global.Event.InformationStage.PlayerWantPlayHandCard, function(data) self:OnReceivePlayerWantPlayHandCard(data) end, "Lua.game.waitResponse.OnReceivePlayerWantPlayHandCard")
end

function WaitResponse:RemoveListener()
	EventManager:RemoveListener(Global.Event.InformationStage.ReceiveAskPlayHandCard, "Lua.game.waitResponse.OnReceiveAskPlayHandCard")
	EventManager:RemoveListener(Global.Event.InformationStage.StopWaitResponseTimer, "Lua.game.waitResponse.OnReceiveStopWaitResponseTimer")
	EventManager:RemoveListener(Global.Event.InformationStage.PlayerWantPlayHandCard, "Lua.game.waitResponse.OnReceivePlayerWantPlayHandCard")
end

function WaitResponse:Dispose()
	self.remainTime = 0
	self.isStart = false
end