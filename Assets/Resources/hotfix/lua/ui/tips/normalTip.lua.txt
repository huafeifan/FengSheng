local ui = {}
local eventQueue = Queue:new()
local tipsFlag = false
local affirmCallBack = nil

local InitUIReference = function()
	ui.content = self.transform:Find("Content")
	ui.item = self.transform:Find("Content/Item")
	ui.tip = self.transform:Find("Content/Item/Text"):GetComponent(typeof(Text))
	ui.closeBtn = self.transform:Find("Content/Item/CloseBtn"):GetComponent(typeof(Button))
	ui.affirmBtn = self.transform:Find("Content/AffirmBtn"):GetComponent(typeof(Button))
end

local InitUI = function()
	ui.content.gameObject:SetActive(false)
	ui.closeBtn.gameObject:SetActive(false)
	ui.affirmBtn.gameObject:SetActive(false)
end

local TryShowTips = function()
	if tipsFlag == false and eventQueue:isEmpty() == false then 
		tipsFlag = true
		
		local tip = eventQueue:dequeue()
		ui.tip.text = tip.content
		affirmCallBack = tip.onComplete
		ui.item.localScale = Vector3.zero
		ui.content.gameObject:SetActive(true)
		ui.item:DOScale(1, 0.15):OnComplete(function()
				ui.closeBtn.gameObject:SetActive(true)
				if affirmCallBack ~= nil then
					ui.affirmBtn.gameObject:SetActive(true)
				end
			end)
	end
	
end

local OnBtnClose = function()
	ui.content.gameObject:SetActive(false)
	ui.closeBtn.gameObject:SetActive(false)
	ui.affirmBtn.gameObject:SetActive(false)
	tipsFlag = false
	TryShowTips()
end
	
local OnBtnAffirm = function()
	if affirmCallBack ~= nil then
		affirmCallBack()
		OnBtnClose()
	end
end

local OnEvent_ShowTips = function(tip)
	eventQueue:enqueue(tip)
	TryShowTips()
end

local AddUIEvent = function()
	UIEventManager:AddListener(ui.closeBtn, OnBtnClose, "lua.normalTip.OnBtnClose")
	UIEventManager:AddListener(ui.affirmBtn, OnBtnAffirm, "lua.normalTip.OnBtnAffirm")
end

local RemoveUIEvent = function()
	UIEventManager:RemoveAllListeners(ui.closeBtn)
	UIEventManager:RemoveAllListeners(ui.affirmBtn)
end

local AddListener = function()
	EventManager:AddListener(Global.Event.ShowTips, OnEvent_ShowTips, "Lua.normalTip.OnEvent_ShowTips")
end

local RemoveListener = function()
	EventManager:RemoveListener(Global.Event.ShowTips, OnEvent_ShowTips)
end

function awake()
	InitUIReference()
end

function onenable()
	InitUI()
	AddUIEvent()
	AddListener()
end

function ondisable()
	RemoveUIEvent()
	RemoveListener()
end

function ondestroy()
	RemoveUIEvent()
	RemoveListener()
end